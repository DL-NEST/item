"use strict";var P=Object.defineProperty;var g=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var f=(o,e,t)=>e in o?P(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,d=(o,e)=>{for(var t in e||(e={}))b.call(e,t)&&f(o,t,e[t]);if(g)for(var t of g(e))v.call(e,t)&&f(o,t,e[t]);return o};var s=require("electron"),l=require("path"),y=require("child_process"),A=require("os"),L=require("url"),B=require("fs");function k(o){if(o&&o.__esModule)return o;var e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});return o&&Object.keys(o).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(o,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return o[t]}})}}),e.default=o,Object.freeze(e)}var h=k(l);function E(o){o.createElectronProcess("taskManager","/taskManager",{width:600,height:500,title:"\u4EFB\u52A1\u7BA1\u7406\u5668",icon:l.join(__dirname,"../../public/favicon.png"),autoHideMenuBar:!0,alwaysOnTop:!0,webPreferences:{contextIsolation:!1,nodeIntegration:!0}},e=>{})}function m(o){o.createElectronProcess("main","/",{width:1055,height:710,icon:l.join(__dirname,"../../public/favicon.png"),frame:!1,titleBarStyle:"hidden",webPreferences:{contextIsolation:!1,nodeIntegration:!0,webSecurity:!0,webgl:!0,preload:l.join(__dirname,"../preload/index.cjs")}},()=>{s.ipcMain.once("btn_switch",(e,t)=>{t==="closeAll"&&o.exitAllTaskProcess()})})}function _(o){o.createElectronProcess("translation","/translation",{maxWidth:710,minHeight:440,height:440,maxHeight:700,title:"\u7FFB\u8BD1",icon:l.join(__dirname,"../../public/favicon.png"),autoHideMenuBar:!0,alwaysOnTop:!0,frame:!1,webPreferences:{contextIsolation:!1,nodeIntegration:!0,preload:l.join(__dirname,"../preload/index.cjs")}},e=>{})}function x(){s.protocol.registerSchemesAsPrivileged([{scheme:"app",privileges:{secure:!0,standard:!0}}])}const T=(o,e)=>{(e||s.protocol).registerBufferProtocol(o,(t,r)=>{let i=new L.URL(t.url).pathname;i=decodeURI(i),B.readFile(h.join(__dirname,"..",i),(n,p)=>{n&&(console.error(`Failed to read ${i} on ${o} protocol`,n),w({title:"url",body:`Failed to read ${h.join(__dirname,i)} on ${o} protocol`}));const c=h.extname(i).toLowerCase();let a="";c===".js"?a="text/javascript":c===".html"?a="text/html":c===".css"?a="text/css":c===".svg"||c===".svgz"?a="image/svg+xml":c===".json"?a="application/json":c===".wasm"&&(a="application/wasm"),r({mimeType:a,data:p})})})};function F(o,e){e=new s.Tray(l.join(__dirname,"../../public/favicon.png"));const t=s.Menu.buildFromTemplate([{label:"\u5173\u4E8E\u9879\u76EE",type:"normal",click:()=>{s.shell.openExternal("https://github.com/DL-NEST").then(r=>{})}},{label:"\u68C0\u6D4B\u66F4\u65B0",type:"normal",click:()=>{w({title:"\u68C0\u6D4B\u66F4\u65B0",body:"\u6CA1\u6709\u66F4\u65B0"})}},{label:"Item2",type:"separator",click:()=>{}},{label:"\u91CD\u65B0\u52A0\u8F7D",type:"normal",click:()=>{o.getMainElectron().reload()}},{label:"\u9000\u51FA",type:"normal",click:()=>{o.exitAllTaskProcess()}}]);e.setToolTip(`item
\u7248\u672C\u53F7\uFF1A0.1.0
\u4F5C\u8005\uFF1Adl-nest`),e.setContextMenu(t),e.on("click",()=>{o.getMainElectron().show()})}function w(o){new s.Notification(d({icon:l.join(__dirname,"../../public/favicon.png")},o)).show()}function S(o){N(),s.ipcMain.on("taskManager_get",(e,t)=>{e.sender.send("taskManager_get_to",o.getAllProcessStatus())}),s.ipcMain.on("taskManager_func",(e,t)=>{switch(t.funcName){case"DevTool":o.getElectronProcessByName(t.processName).webContents.openDevTools();break;case"IpcLog":break;case"Show":o.getElectronProcessByName(t.processName).show();break;case"Kill":o.getElectronProcessByName(t.processName).close();break}}),s.ipcMain.on("MainDevTool",(e,t)=>{s.shell.openPath("chrome.exe").then(r=>{})})}function N(){s.ipcMain.on("btn_switch",(o,e)=>{let t=s.BrowserWindow.getFocusedWindow();if(t)switch(e){case"minimize":t.minimize();break;case"close":t.close();break;case"maximize":t.isMaximized()?t.unmaximize():t.maximize();break;case"fix":t.setAlwaysOnTop(!t.isAlwaysOnTop(),"floating");break}})}function j(){A.release().startsWith("6.1")&&s.app.disableHardwareAcceleration(),process.platform==="win32"&&s.app.setAppUserModelId(s.app.getName()),process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true",x()}class D{constructor(){this.electronProcessList={},this.taskProcessList={}}getTaskProcessList(){return this.taskProcessList}getElectronProcessList(){return this.electronProcessList}getTaskProcessByName(e){return this.taskProcessList[e]}getElectronProcessByName(e){return this.electronProcessList[e]}exitTaskProcessByName(e){return this.taskProcessList[e]}exitElectronProcessByName(e){return this.electronProcessList[e]}getMainElectron(){return this.electronProcessList.main}exitAllTaskProcess(){for(let e in this.taskProcessList)this.taskProcessList[e].kill();for(let e in this.electronProcessList)this.electronProcessList[e].close()}getAllProcessStatus(){let e=[];for(let t in this.taskProcessList)e.push({name:t,cpu:2,mark:"task",memory:3,pid:this.taskProcessList[t].pid,status:this.taskProcessList[t].connected});for(let t in this.electronProcessList)e.push({name:t,cpu:2,mark:"electron",memory:3,pid:this.electronProcessList[t].id,status:this.electronProcessList[t].isDestroyed()});return e}createElectronProcess(e,t,r,i){if(this.electronProcessList[e])return;const n=new s.BrowserWindow(d({show:!1},r));T("app"),s.app.isPackaged?n.loadURL(`app://../render/index.html#${t}`).then(p=>{}):n.loadURL(`http://localhost:3000/#${t}`).then(p=>{}),this.electronProcessList[e]=n,n.on("close",p=>{console.log(`${e} -- close`),delete this.electronProcessList[e]}),n.on("ready-to-show",()=>{n.show()}),i(n)}createTaskProcess(e,t,r){this.taskProcessList[e]||(this.taskProcessList[e]=y.spawn(t,r),this.taskProcessList[e].on("exit",i=>{console.log(`\u4EFB\u52A1\u8FDB\u7A0B ${e} \u9000\u51FA,\u9000\u51FA\u7801\u4E3A: ${i}`),delete this.taskProcessList[e]}))}}let u=new D,C;j();s.app.whenReady().then(async()=>{console.log(s.app.getPath("userData")),console.log(s.app.getPath("home")),s.session.defaultSession.loadExtension("I:\\porject\\vueDevTool").then(()=>{console.log("load Vue devtools success")}),await m(u),I(u),S(u),F(u,C)});s.app.on("activate",()=>{s.BrowserWindow.getAllWindows().length===0&&m(u)});s.app.on("ready",()=>{});s.app.on("window-all-closed",()=>{process.platform!=="darwin"&&s.app.quit()});s.app.on("will-quit",()=>{console.log("will quit"),s.globalShortcut.unregisterAll()});function I(o){s.globalShortcut.isRegistered("Alt+q")&&console.log("have registered");let e=o.getMainElectron();s.globalShortcut.register("Alt+q",()=>{e.isFocused()?(e.minimize(),e.reload()):e.focus()}),s.globalShortcut.register("Alt+w",()=>{e.webContents.isDevToolsOpened()?e.webContents.closeDevTools():e.webContents.openDevTools({mode:"undocked"})}),s.globalShortcut.register("Alt+e",()=>{E(o)}),s.globalShortcut.register("Alt+x",()=>{o.getElectronProcessByName("translation")?o.getElectronProcessByName("translation").isFocused()?o.getElectronProcessByName("translation").hide():o.getElectronProcessByName("translation").show():_(o)}),s.globalShortcut.register("Alt+d",()=>{console.log("Alt+b"),o.getElectronProcessByName("main").webContents.send("rollbackInNav","webview")}),s.globalShortcut.register("Alt+s",()=>{var t;console.log("Alt+b"),(t=s.BrowserWindow.getFocusedWindow())==null||t.reload()})}
//# sourceMappingURL=main.cjs.map
