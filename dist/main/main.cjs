"use strict";var w=Object.defineProperty,E=Object.defineProperties;var F=Object.getOwnPropertyDescriptors;var c=Object.getOwnPropertySymbols;var C=Object.prototype.hasOwnProperty,g=Object.prototype.propertyIsEnumerable;var h=(e,t,n)=>t in e?w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,r=(e,t)=>{for(var n in t||(t={}))C.call(t,n)&&h(e,n,t[n]);if(c)for(var n of c(t))g.call(t,n)&&h(e,n,t[n]);return e},d=(e,t)=>E(e,F(t));var b=require("os"),i=require("electron"),l=require("path");function B(e){new i.Notification(r({icon:l.join(__dirname,"../../public/favicon.png")},e)).show()}function A(e,t){let n=new i.Tray(e);const u=i.Menu.buildFromTemplate([{label:"\u5173\u4E8E\u9879\u76EE",type:"normal",click:()=>{i.shell.openExternal("https://github.com/DL-NEST").then(o=>{})}},{label:"\u68C0\u6D4B\u66F4\u65B0",type:"normal",click:()=>{B({title:"\u68C0\u6D4B\u66F4\u65B0",body:"\u6CA1\u6709\u66F4\u65B0"})}},{label:"Item2",type:"separator",click:()=>{}},{label:"\u91CD\u65B0\u52A0\u8F7D",type:"normal",click:()=>{t.getMain().reload(),t.getMain().show()}},{label:"\u9000\u51FA",type:"normal",click:()=>{t.closeAll()}}]);n.setToolTip(`item
\u7248\u672C\u53F7\uFF1A0.1.0
\u4F5C\u8005\uFF1Adl-nest`),n.setContextMenu(u),n.on("click",()=>{t.getMain().show()})}function M(e){i.globalShortcut.register("Alt+q",()=>{e.isFocused()?(e.minimize(),e.reload()):e.focus()}),i.globalShortcut.register("Alt+w",()=>{e.webContents.isDevToolsOpened()?e.webContents.closeDevTools():e.webContents.openDevTools({mode:"undocked"})})}let m=[{name:"\u6587\u4EF6",active:!1,subList:[[{name:"\u65B0\u5EFA",shortcuts:"Ctrl+N",click:e=>{e.getMain().hide()}},{name:"\u6253\u5F00",shortcuts:"Ctrl+O",click:e=>{}},{name:"\u4FDD\u5B58",shortcuts:"Ctrl+S"},{name:"\u53E6\u5B58\u4E3A",shortcuts:"Ctrl+Shift+S"}],[{name:"\u67E5\u627E",shortcuts:"Ctrl+F"},{name:"\u66FF\u6362",shortcuts:"Ctrl+H"},{name:"\u8F6C\u5230",shortcuts:"Ctrl+G"},{name:"\u67E5\u627E\u6587\u4EF6",shortcuts:"Ctrl+Shift+F"},{name:"\u67E5\u627E\u76EE\u5F55",shortcuts:"Ctrl+Shift+D"},{name:"\u67E5\u627E\u8DEF\u5F84",shortcuts:"Ctrl+Shift+P"}],[{name:"\u9000\u51FA",shortcuts:"Ctrl+Q"}]]},{name:"\u7F16\u8F91",active:!1,subList:[[{name:"\u66F4\u6539\u5927\u5C0F\u5199",shortcuts:"Ctrl+Shift+C"},{name:"\u66F4\u6539\u65E5\u671F",shortcuts:"Ctrl+Shift+H"},{name:"\u5FEB\u6377\u952E\u8BBE\u7F6E"}],[{name:"\u9875\u9762\u8BBE\u7F6E",shortcuts:"Ctrl+Shift+P"}]]},{name:"\u63D2\u4EF6",active:!1,subList:[[{name:"\u63D2\u4EF6\u7BA1\u7406",shortcuts:"Ctrl+Shift+L"},{name:"\u4EFB\u52A1\u7BA1\u7406\u5668",shortcuts:"Ctrl+Shift+T",click:e=>{console.log("taskManager");let t="\u4EFB\u52A1\u7BA1\u7406\u5668";e.createChild(t,"/taskManager",{title:t,width:500,height:450,autoHideMenuBar:!0,alwaysOnTop:!0})}}],[{name:"\u4F5C\u8005",shortcuts:"Ctrl+Shift+P"}]]}];function S(){i.ipcMain.on("btn_switch",(e,t)=>{let n=i.BrowserWindow.getFocusedWindow();switch(t){case"minimize":n.minimize();break;case"close":i.BrowserWindow.getAllWindows().forEach(u=>{u.close()});break;case"maximize":n.isMaximized()?n.unmaximize():n.maximize();break;case"fix":n.setAlwaysOnTop(!n.isAlwaysOnTop(),"floating");break}})}function k(e){i.ipcMain.on("menu_fun",(t,n)=>{_(n,e)})}function _(e,t){m.forEach(n=>{n.subList.forEach(u=>{u.forEach(o=>{if(o.name===e){o.click&&o.click(t);return}})})})}function T(e){i.ipcMain.on("windows",(t,n)=>{e.createChild(n.name,"http://localhost:3000/#/taskManager",{icon:l.join(__dirname,"../../public/favicon.png"),title:n.title,width:n.width,height:n.height,autoHideMenuBar:!0,modal:n.model,alwaysOnTop:n.alwaysOnTop})})}function v(e){S(),k(e),T(e)}function y(e){const t=new i.Menu;m.forEach(n=>{const u=new i.MenuItem({label:n.name,submenu:D(n.subList,e)});t.append(u)}),i.Menu.setApplicationMenu(t)}function D(e,t){let n=[];return e.forEach(u=>{u.forEach(o=>{n.push({label:o.name,accelerator:o.shortcuts,click:()=>{o.click&&o.click(t)}})})}),n}class W{constructor(t){this.main=t,this.child=new Map}getMain(){return this.main}createChild(t,n,u){let o=this.getChild(t);if(o)return o.show(),o;{let s=new i.BrowserWindow(d(r({},u),{icon:l.join(__dirname,"../../public/favicon.png"),webPreferences:{contextIsolation:!1,nodeIntegration:!0}}));return i.app.isPackaged?s.loadFile(l.join(__dirname,"../render/index.html")+`/#${n}`):s.loadURL(`http://localhost:3000/#${n}`),s.webContents.openDevTools(),this.child.set(t,s),s}}getChild(t){return this.child.get(t)}closeChildWindows(){this.child.forEach(t=>{t.close()})}closeAll(){i.BrowserWindow.getAllWindows().forEach(t=>{t.close()})}}b.release().startsWith("6.1")&&i.app.disableHardwareAcceleration();process.platform==="win32"&&i.app.setAppUserModelId(i.app.getName());process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true";let p=l.join(__dirname,"../../public/favicon.png"),a=null;function f(){a=new W(new i.BrowserWindow({title:"main",width:1055,height:710,icon:p,frame:!1,titleBarStyle:"hidden",webPreferences:{contextIsolation:!1,nodeIntegration:!0,webSecurity:!0,webgl:!0,preload:l.join(__dirname,"../preload/index.cjs")}})),a.main.on("ready-to-show",()=>{var e;(e=a.main)==null||e.show()}),i.app.isPackaged?a.main.loadFile(l.join(__dirname,"../render/index.html")).then(e=>{console.log("PRO_MODE")}):a.main.loadURL("http://localhost:3000").then(e=>{console.log("TEST_MODE")})}i.app.whenReady().then(()=>{f(),A(p,a),M(a.main),v(a),y(a)});i.app.on("activate",()=>{i.BrowserWindow.getAllWindows().length===0&&f()});i.app.on("ready",()=>{});i.app.on("window-all-closed",()=>{process.platform!=="darwin"&&i.app.quit()});
