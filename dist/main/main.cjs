"use strict";var w=Object.defineProperty;var f=Object.getOwnPropertySymbols;var b=Object.prototype.hasOwnProperty,v=Object.prototype.propertyIsEnumerable;var m=(s,e,t)=>e in s?w(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t,d=(s,e)=>{for(var t in e||(e={}))b.call(e,t)&&m(s,t,e[t]);if(f)for(var t of f(e))v.call(e,t)&&m(s,t,e[t]);return s};var o=require("electron"),c=require("path"),y=require("child_process"),L=require("os"),A=require("url"),k=require("fs");function B(s){if(s&&s.__esModule)return s;var e=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});return s&&Object.keys(s).forEach(function(t){if(t!=="default"){var r=Object.getOwnPropertyDescriptor(s,t);Object.defineProperty(e,t,r.get?r:{enumerable:!0,get:function(){return s[t]}})}}),e.default=s,Object.freeze(e)}var h=B(c);function E(s){s.createElectronProcess("taskManager","/taskManager",{width:600,height:500,title:"\u4EFB\u52A1\u7BA1\u7406\u5668",icon:c.join(__dirname,"../../public/favicon.png"),autoHideMenuBar:!0,alwaysOnTop:!0,webPreferences:{contextIsolation:!1,nodeIntegration:!0}},e=>{})}function g(s){s.createElectronProcess("main","/",{width:1055,height:710,icon:c.join(__dirname,"../../public/favicon.png"),frame:!1,titleBarStyle:"hidden",webPreferences:{contextIsolation:!1,nodeIntegration:!0,webSecurity:!0,webgl:!0,preload:c.join(__dirname,"../preload/index.cjs")}},()=>{o.ipcMain.once("btn_switch",(e,t)=>{t==="closeAll"&&s.exitAllTaskProcess()})})}function _(s){s.createElectronProcess("translation","/translation",{maxWidth:710,minHeight:440,height:440,maxHeight:700,title:"\u7FFB\u8BD1",icon:c.join(__dirname,"../../public/favicon.png"),autoHideMenuBar:!0,alwaysOnTop:!0,frame:!1,webPreferences:{contextIsolation:!1,nodeIntegration:!0,preload:c.join(__dirname,"../preload/index.cjs")}},e=>{})}function x(){o.protocol.registerSchemesAsPrivileged([{scheme:"app",privileges:{secure:!0,standard:!0}}])}const T=(s,e)=>{(e||o.protocol).registerBufferProtocol(s,(t,r)=>{let i=new A.URL(t.url).pathname;i=decodeURI(i),k.readFile(h.join(__dirname,"..",i),(n,p)=>{n&&(console.error(`Failed to read ${i} on ${s} protocol`,n),P({title:"url",body:`Failed to read ${h.join(__dirname,i)} on ${s} protocol`}));const l=h.extname(i).toLowerCase();let a="";l===".js"?a="text/javascript":l===".html"?a="text/html":l===".css"?a="text/css":l===".svg"||l===".svgz"?a="image/svg+xml":l===".json"?a="application/json":l===".wasm"&&(a="application/wasm"),r({mimeType:a,data:p})})})};function F(s,e){e=new o.Tray(c.join(__dirname,"../../public/favicon.png"));const t=o.Menu.buildFromTemplate([{label:"\u5173\u4E8E\u9879\u76EE",type:"normal",click:()=>{o.shell.openExternal("https://github.com/DL-NEST").then(r=>{})}},{label:"\u68C0\u6D4B\u66F4\u65B0",type:"normal",click:()=>{P({title:"\u68C0\u6D4B\u66F4\u65B0",body:"\u6CA1\u6709\u66F4\u65B0"})}},{label:"Item2",type:"separator",click:()=>{}},{label:"\u91CD\u65B0\u52A0\u8F7D",type:"normal",click:()=>{s.getMainElectron().reload()}},{label:"\u9000\u51FA",type:"normal",click:()=>{s.exitAllTaskProcess()}}]);e.setToolTip(`item
\u7248\u672C\u53F7\uFF1A0.1.0
\u4F5C\u8005\uFF1Adl-nest`),e.setContextMenu(t),e.on("click",()=>{s.getMainElectron().show()})}function P(s){new o.Notification(d({icon:c.join(__dirname,"../../public/favicon.png")},s)).show()}function S(s){N(),o.ipcMain.on("taskManager_get",(e,t)=>{e.sender.send("taskManager_get_to",s.getAllProcessStatus())}),o.ipcMain.on("taskManager_func",(e,t)=>{switch(t.funcName){case"DevTool":s.getElectronProcessByName(t.processName).webContents.openDevTools();break;case"IpcLog":break;case"Show":s.getElectronProcessByName(t.processName).show();break;case"Kill":s.getElectronProcessByName(t.processName).close();break}}),o.ipcMain.on("MainDevTool",(e,t)=>{o.shell.openPath("chrome.exe").then(r=>{})})}function N(){o.ipcMain.on("btn_switch",(s,e)=>{let t=o.BrowserWindow.getFocusedWindow();if(t)switch(e){case"minimize":t.minimize();break;case"close":t.close();break;case"maximize":t.isMaximized()?t.unmaximize():t.maximize();break;case"fix":t.setAlwaysOnTop(!t.isAlwaysOnTop(),"floating");break}})}function j(){L.release().startsWith("6.1")&&o.app.disableHardwareAcceleration(),process.platform==="win32"&&o.app.setAppUserModelId(o.app.getName()),process.env.ELECTRON_DISABLE_SECURITY_WARNINGS="true",x()}class D{constructor(){this.electronProcessList={},this.taskProcessList={}}getTaskProcessList(){return this.taskProcessList}getElectronProcessList(){return this.electronProcessList}getTaskProcessByName(e){return this.taskProcessList[e]}getElectronProcessByName(e){return this.electronProcessList[e]}exitTaskProcessByName(e){return this.taskProcessList[e]}exitElectronProcessByName(e){return this.electronProcessList[e]}getMainElectron(){return this.electronProcessList.main}exitAllTaskProcess(){for(let e in this.taskProcessList)this.taskProcessList[e].kill();for(let e in this.electronProcessList)this.electronProcessList[e].close()}getAllProcessStatus(){let e=[];for(let t in this.taskProcessList)e.push({name:t,cpu:2,mark:"task",memory:3,pid:this.taskProcessList[t].pid,status:this.taskProcessList[t].connected});for(let t in this.electronProcessList)e.push({name:t,cpu:2,mark:"electron",memory:3,pid:this.electronProcessList[t].id,status:this.electronProcessList[t].isDestroyed()});return e}createElectronProcess(e,t,r,i){if(this.electronProcessList[e])return;const n=new o.BrowserWindow(d({show:!1},r));T("app"),o.app.isPackaged?n.loadURL(`app://../render/index.html#${t}`).then(p=>{}):n.loadURL(`http://localhost:3000/#${t}`).then(p=>{}),this.electronProcessList[e]=n,n.on("close",p=>{console.log(`${e} -- close`),delete this.electronProcessList[e]}),n.on("ready-to-show",()=>{n.show()}),i(n)}createTaskProcess(e,t,r){this.taskProcessList[e]||(this.taskProcessList[e]=y.spawn(t,r),this.taskProcessList[e].on("exit",i=>{console.log(`\u4EFB\u52A1\u8FDB\u7A0B ${e} \u9000\u51FA,\u9000\u51FA\u7801\u4E3A: ${i}`),delete this.taskProcessList[e]}))}}let u=new D,C;j();o.app.whenReady().then(async()=>{console.log(o.app.getPath("userData")),console.log(o.app.getPath("home")),o.session.defaultSession.loadExtension("I:\\porject\\vueDevTool").then(()=>{console.log("load Vue devtools success")}),await g(u),I(u),S(u),F(u,C)});o.app.on("activate",()=>{o.BrowserWindow.getAllWindows().length===0&&g(u)});o.app.on("ready",()=>{});o.app.on("window-all-closed",()=>{process.platform!=="darwin"&&o.app.quit()});o.app.on("will-quit",()=>{console.log("will quit"),o.globalShortcut.unregisterAll()});function I(s){o.globalShortcut.isRegistered("Alt+q")&&console.log("have registered");let e=s.getMainElectron();o.globalShortcut.register("Alt+q",()=>{e.isFocused()?(e.minimize(),e.reload()):e.focus()}),o.globalShortcut.register("Alt+w",()=>{e.webContents.isDevToolsOpened()?e.webContents.closeDevTools():e.webContents.openDevTools({mode:"undocked"})}),o.globalShortcut.register("Alt+e",()=>{E(s)}),o.globalShortcut.register("Alt+x",()=>{s.getElectronProcessByName("translation")?s.getElectronProcessByName("translation").isFocused()?s.getElectronProcessByName("translation").hide():s.getElectronProcessByName("translation").show():_(s)}),o.globalShortcut.register("Alt+d",()=>{console.log("Alt+b"),s.getElectronProcessByName("main").webContents.send("rollbackInNav","webview")})}
//# sourceMappingURL=main.cjs.map
